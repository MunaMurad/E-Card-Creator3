{"ast":null,"code":"/**\r\n * Does a simple sanitization of all elements\r\n * in an untrusted string\r\n */\nconst sanitizeDOMString = untrustedString => {\n  try {\n    if (untrustedString instanceof IonicSafeString) {\n      return untrustedString.value;\n    }\n\n    if (!isSanitizerEnabled() || typeof untrustedString !== 'string' || untrustedString === '') {\n      return untrustedString;\n    }\n    /**\r\n     * Create a document fragment\r\n     * separate from the main DOM,\r\n     * create a div to do our work in\r\n     */\n\n\n    const documentFragment = document.createDocumentFragment();\n    const workingDiv = document.createElement('div');\n    documentFragment.appendChild(workingDiv);\n    workingDiv.innerHTML = untrustedString;\n    /**\r\n     * Remove any elements\r\n     * that are blocked\r\n     */\n\n    blockedTags.forEach(blockedTag => {\n      const getElementsToRemove = documentFragment.querySelectorAll(blockedTag);\n\n      for (let elementIndex = getElementsToRemove.length - 1; elementIndex >= 0; elementIndex--) {\n        const element = getElementsToRemove[elementIndex];\n\n        if (element.parentNode) {\n          element.parentNode.removeChild(element);\n        } else {\n          documentFragment.removeChild(element);\n        }\n        /**\r\n         * We still need to sanitize\r\n         * the children of this element\r\n         * as they are left behind\r\n         */\n\n\n        const childElements = getElementChildren(element);\n        /* tslint:disable-next-line */\n\n        for (let childIndex = 0; childIndex < childElements.length; childIndex++) {\n          sanitizeElement(childElements[childIndex]);\n        }\n      }\n    });\n    /**\r\n     * Go through remaining elements and remove\r\n     * non-allowed attribs\r\n     */\n    // IE does not support .children on document fragments, only .childNodes\n\n    const dfChildren = getElementChildren(documentFragment);\n    /* tslint:disable-next-line */\n\n    for (let childIndex = 0; childIndex < dfChildren.length; childIndex++) {\n      sanitizeElement(dfChildren[childIndex]);\n    } // Append document fragment to div\n\n\n    const fragmentDiv = document.createElement('div');\n    fragmentDiv.appendChild(documentFragment); // First child is always the div we did our work in\n\n    const getInnerDiv = fragmentDiv.querySelector('div');\n    return getInnerDiv !== null ? getInnerDiv.innerHTML : fragmentDiv.innerHTML;\n  } catch (err) {\n    console.error(err);\n    return '';\n  }\n};\n/**\r\n * Clean up current element based on allowed attributes\r\n * and then recursively dig down into any child elements to\r\n * clean those up as well\r\n */\n\n\nconst sanitizeElement = element => {\n  // IE uses childNodes, so ignore nodes that are not elements\n  if (element.nodeType && element.nodeType !== 1) {\n    return;\n  }\n\n  for (let i = element.attributes.length - 1; i >= 0; i--) {\n    const attribute = element.attributes.item(i);\n    const attributeName = attribute.name; // remove non-allowed attribs\n\n    if (!allowedAttributes.includes(attributeName.toLowerCase())) {\n      element.removeAttribute(attributeName);\n      continue;\n    } // clean up any allowed attribs\n    // that attempt to do any JS funny-business\n\n\n    const attributeValue = attribute.value;\n    /* tslint:disable-next-line */\n\n    if (attributeValue != null && attributeValue.toLowerCase().includes('javascript:')) {\n      element.removeAttribute(attributeName);\n    }\n  }\n  /**\r\n   * Sanitize any nested children\r\n   */\n\n\n  const childElements = getElementChildren(element);\n  /* tslint:disable-next-line */\n\n  for (let i = 0; i < childElements.length; i++) {\n    sanitizeElement(childElements[i]);\n  }\n};\n/**\r\n * IE doesn't always support .children\r\n * so we revert to .childNodes instead\r\n */\n\n\nconst getElementChildren = el => {\n  return el.children != null ? el.children : el.childNodes;\n};\n\nconst isSanitizerEnabled = () => {\n  const win = window;\n  const config = win && win.Ionic && win.Ionic.config;\n\n  if (config) {\n    if (config.get) {\n      return config.get('sanitizerEnabled', true);\n    } else {\n      return config.sanitizerEnabled === true || config.sanitizerEnabled === undefined;\n    }\n  }\n\n  return true;\n};\n\nconst allowedAttributes = ['class', 'id', 'href', 'src', 'name', 'slot'];\nconst blockedTags = ['script', 'style', 'iframe', 'meta', 'link', 'object', 'embed'];\n\nclass IonicSafeString {\n  constructor(value) {\n    this.value = value;\n  }\n\n}\n\nexport { IonicSafeString as I, sanitizeDOMString as s };","map":null,"metadata":{},"sourceType":"module"}