{"version":3,"file":"ngx-qrcode-svg.umd.js","sources":["../../../projects/ngx-qrcode-svg/src/lib/ngx-qrcode-svg.component.ts","../../../projects/ngx-qrcode-svg/src/lib/ngx-qrcode-svg.module.ts","../../../projects/ngx-qrcode-svg/src/public-api.ts","../../../projects/ngx-qrcode-svg/src/ngx-qrcode-svg.ts"],"sourcesContent":["import { Component, Input, ElementRef, OnChanges, Renderer2 } from '@angular/core';\nimport QRCode from 'qrcode';\nimport { ErrorCorrectionLevel, QRCodeData, Options } from './ngx-qrcode-svg.types';\n\n@Component({\n  selector: 'qrcode-svg',\n  template: '',\n  styles: [\n    `\n      :host {\n        display: inline-block;\n        width: 100%;\n        height: 100%;\n      }\n      svg {\n        display: block;\n        shape-rendering: crispEdges;\n      }\n    `,\n  ],\n})\nexport class QRCodeSVGComponent implements OnChanges {\n  @Input() value: string;\n  @Input() errorCorrectionLevel?: ErrorCorrectionLevel;\n  @Input() margin?: number | string;\n  @Input() color?: string;\n  @Input() backgroundColor?: string;\n\n  readonly default: Options = {\n    errorCorrectionLevel: 'Q',\n    margin: 4,\n    color: 'currentcolor',\n    backgroundColor: 'transparent',\n  };\n\n  constructor(private renderer: Renderer2, private element: ElementRef) {}\n\n  ngOnChanges() {\n    this.createQRCode();\n  }\n\n  private createQRCode(): void {\n    this.element.nativeElement.childNodes.forEach((node) =>\n      this.renderer.removeChild(this.element.nativeElement, node)\n    );\n\n    if (!this.value) {\n      return;\n    }\n\n    const { errorCorrectionLevel, margin, color, backgroundColor } = this.sanitizeInputs();\n\n    const raw = QRCode.create(`${this.value}`, {\n      errorCorrectionLevel,\n      margin,\n    });\n    this.renderSVG(raw, margin, color, backgroundColor);\n  }\n\n  private renderSVG(raw: QRCodeData, margin: number, color: string, backgroundColor: string): void {\n    const elementSize = raw.modules.size + margin * 2;\n\n    const svgElement = this.renderer.createElement('svg', 'svg');\n    this.renderer.setAttribute(svgElement, 'xmlns', 'http://www.w3.org/2000/svg');\n    this.renderer.setAttribute(svgElement, 'viewBox', `0 0 ${elementSize} ${elementSize}`);\n\n    const backGroundElement = this.renderer.createElement('path', 'svg');\n    this.renderer.setAttribute(backGroundElement, 'd', `M0 0h${elementSize}v${elementSize}H0z`);\n    this.renderer.setStyle(backGroundElement, 'fill', backgroundColor);\n    this.renderer.appendChild(svgElement, backGroundElement);\n\n    const codeElement = this.renderer.createElement('path', 'svg');\n    this.renderer.setAttribute(codeElement, 'd', this.createPath(raw, margin));\n    this.renderer.setStyle(codeElement, 'stroke', color);\n    this.renderer.appendChild(svgElement, codeElement);\n\n    this.renderer.appendChild(this.element.nativeElement, svgElement);\n  }\n\n  private createPath(raw: QRCodeData, margin: number): string {\n    const { data, size } = raw.modules;\n\n    let path = '';\n    let moveBy = 0;\n    let newRow = false;\n    let lineLength = 0;\n\n    data.forEach((bit, index) => {\n      const col = Math.floor(index % size);\n      const row = Math.floor(index / size);\n\n      if (!col && !newRow) {\n        newRow = true;\n      }\n\n      if (bit) {\n        lineLength++;\n\n        if (!(index > 0 && col > 0 && data?.[index - 1])) {\n          path += newRow ? `M${col + margin} ${0.5 + row + margin}` : `m${moveBy} 0`;\n          moveBy = 0;\n          newRow = false;\n        }\n\n        if (!(col + 1 < size && data?.[index + 1])) {\n          path += `h${lineLength}`;\n          lineLength = 0;\n        }\n      } else {\n        moveBy++;\n      }\n    });\n\n    return path;\n  }\n\n  private sanitizeInputs(): Options {\n    const errorCorrectionLevel = ['L', 'M', 'Q', 'H'].includes(this.errorCorrectionLevel)\n      ? this.errorCorrectionLevel\n      : this.default.errorCorrectionLevel;\n\n    const margin =\n      !isNaN(parseFloat(this.margin as any)) && !isNaN(Number(this.margin))\n        ? Math.max(Number(this.margin), 0)\n        : this.default.margin;\n\n    const color = this.color ?? this.default.color;\n    const backgroundColor = this.backgroundColor ?? this.default.backgroundColor;\n\n    return { errorCorrectionLevel, margin, color, backgroundColor };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { QRCodeSVGComponent } from './ngx-qrcode-svg.component';\n\n@NgModule({\n  declarations: [QRCodeSVGComponent],\n  imports: [],\n  exports: [QRCodeSVGComponent],\n})\nexport class QRCodeSVGModule {}\n","/*\n * Public API Surface of ngx-qrcode-svg\n */\n\nexport * from './lib/ngx-qrcode-svg.component';\nexport * from './lib/ngx-qrcode-svg.module';\nexport { ErrorCorrectionLevel } from './lib/ngx-qrcode-svg.types';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["Component","Renderer2","ElementRef","Input","NgModule"],"mappings":"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"}